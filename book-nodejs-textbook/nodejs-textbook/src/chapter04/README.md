# Chapter04. http ëª¨ë“ˆë¡œ ì„œë²„ ë§Œë“¤ê¸°

## ğŸ“Œ 4.1 ìš”ì²­ê³¼ ì‘ë‹µ ì´í•´í•˜ê¸°

- í´ë¼ì´ì–¸íŠ¸ì—ì„œ ì„œë²„ë¡œ ìš”ì²­(request)ì„ ë³´ë‚´ê³ , ì„œë²„ì—ì„œëŠ” ìš”ì²­ì˜ ë‚´ìš©ì„ ì½ê³  ì²˜ë¦¬í•œ ë’¤ í´ë¼ì´ì–¸íŠ¸ì— ì‘ë‹µ(response)ì„ ë³´ëƒ…ë‹ˆë‹¤.
- ì„œë²„ì—ëŠ” ìš”ì²­ì„ ë°›ëŠ” ë¶€ë¶„ê³¼ ì‘ë‹µì„ ë³´ë‚´ëŠ” ë¶€ë¶„ì´ ìˆì–´ì•¼ í•©ë‹ˆë‹¤.
- ìš”ì²­ê³¼ ì‘ë‹µì€ ì´ë²¤íŠ¸ ë°©ì‹ì´ë¼ê³  ìƒê°í•˜ë©´ ë©ë‹ˆë‹¤.
- í´ë¼ì´ì–¸íŠ¸ë¡œë¶€í„° ìš”ì²­ì´ ì™”ì„ ë•Œ ì–´ë–¤ ì‘ì—…ì„ ìˆ˜í–‰í• ì§€ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆë¥¼ ë¯¸ë¦¬ ë“±ë¡í•´ë‘ì–´ì•¼ í•©ë‹ˆë‹¤.

  ```javascript
  const http = require('http')

  http.createServer((req, res) => {
    // ì—¬ê¸°ì— ì–´ë–»ê²Œ ì‘ë‹µí• ì§€ ì ìŠµë‹ˆë‹¤.
  })
  ```

  - http ì„œë²„ê°€ ìˆì–´ì•¼ ì›¹ ë¸Œë¼ìš°ì €ì˜ ìš”ì²­ì„ ì²˜ë¦¬í• ìˆ˜ ìˆìœ¼ë¯€ë¡œ http ëª¨ë“ˆì„ ì‚¬ìš©í–ˆìŠµë‹ˆë‹¤.
  - createServer ë©”ì„œë“œëŠ” ì¸ìˆ˜ë¡œ ìš”ì²­ì— ëŒ€í•œ ì½œë°± í•¨ìˆ˜ë¥¼ ë„£ì„ ìˆ˜ ìˆìœ¼ë©°, ìš”ì²­ì´ ë“¤ì–´ì˜¬ ë•Œë§ˆë‹¤ ë§¤ë²ˆ ì½œë°± í•¨ìˆ˜ê°€ ì‹¤í–‰ë©ë‹ˆë‹¤.
  - req ëŠ” requset ë¥¼ ì¤„ì¸ í‘œí˜„ì´ë©°, ìš”ì²­ì— ê´€í•œ ì •ë³´ë“¤ì„ ë‹´ê³  ìˆìŠµë‹ˆë‹¤.
  - res ëŠ” response ë¥¼ ì¤„ì¸ í‘œí˜„ì´ë©°, ì‘ë‹µì— ê´€í•œ ì •ë³´ë“¤ì„ ë‹´ê³  ìˆìŠµë‹ˆë‹¤.

- ì‘ë‹µì„ ë³´ë‚´ëŠ” ë¶€ë¶„ê³¼ ì„œë²„ì— ì—°ê²° ì¶”ê°€

  ```javascript
  const http = require('http')

  http
    .createServer((req, res) => {
      res.writeHead(200, { 'Content-Type': 'text/html; charset=utf-8' })
      res.write('<h1>Hello Node!</h1>')
      res.end('<p>Hello Server!</p>')
    })
    .listen(8080, () => {
      console.log('8080ë²ˆ í¬íŠ¸ì—ì„œ ì„œë²„ ëŒ€ê¸° ì¤‘ì…ë‹ˆë‹¤.')
    })
  ```

  ```HTML
  <!-- ìš”ì²­ ê²°ê³¼ -->
  HTTP/1.1 200 OK
  Connection: keep-alive
  Content-Type: text/html; charset=utf-8
  Date: Thu, 30 Dec 2021 13:04:50 GMT
  Keep-Alive: timeout=5
  Transfer-Encoding: chunked

  <h1>Hello Node!</h1><p>Hello Server!</p>
  ```

  - listen ë©”ì„œë“œì— í´ë¼ì´ì–¸íŠ¸ì— ê³µê°œí•  í¬íŠ¸ ë²ˆí˜¸ì™€ í¬íŠ¸ ì—°ê²° ì™„ë£Œ í›„ ì‹¤í–‰ë  ì½œë°± í•¨ìˆ˜ë¥¼ ë„£ìŠµë‹ˆë‹¤.
  - res.writeHead ëŠ” ì‘ë‹µì˜ í—¤ë”(Header)ì— ì •ë³´ë¥¼ ê¸°ë¡í•˜ëŠ” ë©”ì„œë“œì…ë‹ˆë‹¤.
  - res.write ëŠ” ì‘ë‹µì˜ ë°”ë””(Body)ì— ë°ì´í„°ë¥¼ ê¸°ë¡í•˜ëŠ” ë©”ì„œë“œì…ë‹ˆë‹¤.
  - res.end ëŠ” ì‘ë‹µì„ ì¢…ë£Œí•˜ëŠ” ë©”ì„œë“œì…ë‹ˆë‹¤. ë§Œì•½ ì¸ìˆ˜ê°€ ìˆë‹¤ë©´ ê·¸ ë°ì´í„°ë„ í´ë¼ì´ì–¸íŠ¸ë¡œ ë³´ë‚´ê³  ì‘ë‹µì„ ì¢…ë£Œí•©ë‹ˆë‹¤.

- localhost ì™€ Port

  - localhost
    - localhostëŠ” í˜„ì¬ ì»´í“¨í„°ì˜ ë‚´ë¶€ ì£¼ì†Œë¥¼ ê°€ë¦¬í‚µë‹ˆë‹¤.
    - ì™¸ë¶€ì—ì„œëŠ” ì ‘ê·¼í•  ìˆ˜ ì—†ê³  ìì‹ ì˜ ì»´í“¨í„°ì—ì„œë§Œ ì ‘ê·¼í•  ìˆ˜ ìˆìœ¼ë¯€ë¡œ, ì„œë²„ ê°œë°œ ì‹œ í…ŒìŠ¤íŠ¸ìš©ìœ¼ë¡œ ë§ì´ ì‚¬ìš©ë©ë‹ˆë‹¤.
    - localhost ëŒ€ì‹  127.0.0.1 ì„ ì£¼ì†Œë¡œ ì‚¬ìš©í•´ë„ ê°™ìŠµë‹ˆë‹¤. ì´ëŸ¬í•œ ì£¼ì†Œë¥¼ IP(Internet Protocol)ë¼ê³  ë¶€ë¦…ë‹ˆë‹¤.
  - Port
    - í¬íŠ¸ëŠ” ì„œë²„ ë‚´ì—ì„œ í”„ë¡œì„¸ìŠ¤ë¥¼ êµ¬ë¶„í•˜ëŠ” ë²ˆí˜¸ì…ë‹ˆë‹¤.
    - ì„œë²„ëŠ” HTTP ìš”ì²­ì„ ëŒ€ê¸°í•˜ëŠ” ê²ƒ ì™¸ì—ë„ ë‹¤ì–‘í•œ ì‘ì—…ì„ í•©ë‹ˆë‹¤. ì„œë²„ëŠ” ê°ê°ì˜ í”„ë¡œì„¸ìŠ¤ì— í¬íŠ¸ë¥¼ ë‹¤ë¥´ê²Œ í• ë‹¹í•˜ì—¬ ë“¤ì–´ì˜¤ëŠ” ìš”ì²­ì„ êµ¬ë¶„í•©ë‹ˆë‹¤.
    - ìœ ëª…í•œ í¬íŠ¸ ë²ˆí˜¸ë¡œëŠ” 21(FTP), 80(HTTP), 443(HTTPS), 3306(MYSQL)ì´ ìˆìŠµë‹ˆë‹¤.
    - ë¦¬ëˆ…ìŠ¤ì™€ ë§¥ì—ì„œëŠ” 1024ë²ˆ ì´í•˜ì˜ í¬íŠ¸ì— ì—°ê²°í•  ë•Œ ê´€ë¦¬ì ê¶Œí•œì´ í•„ìš”í•©ë‹ˆë‹¤.

- listening ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ë°©ì‹

  ```javascript
  const http = require('http')

  const server = http.createServer((req, res) => {
    res.writeHead(200, { 'Content-Type': 'text/html; charset=utf-8' })
    res.write('<h1>Hello Node!</h1>')
    res.end('<p>Hello Server!</p>')
  })

  server.listen(8080)

  server.on('listening', () => {
    console.log('8080ë²ˆ í¬íŠ¸ì—ì„œ ì„œë²„ ëŒ€ê¸° ì¤‘ì…ë‹ˆë‹¤!')
  })

  server.on('error', (error) => {
    console.error(error)
  })
  ```

- í•œ ë²ˆì— ì—¬ëŸ¬ ì„œë²„ë¥¼ ì‹¤í•¼í•  ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤.

  ```javascript
  const http = require('http')

  http
    .createServer((req, res) => {
      res.writeHead(200, { 'Content-Type': 'text/html; charset=utf-8' })
      res.write('<h1>Hello Node!</h1>')
      res.end('<p>Hello Server!</p>')
    })
    .listen(8080, () => {
      console.log('8080ë²ˆ í¬íŠ¸ì—ì„œ ì„œë²„ ëŒ€ê¸° ì¤‘ì…ë‹ˆë‹¤.')
    })

  http
    .createServer((req, res) => {
      res.writeHead(200, { 'Content-Type': 'text/html; charset=utf-8' })
      res.write('<h1>Hello Node!</h1>')
      res.end('<p>Hello Server!</p>')
    })
    .listen(8081, () => {
      console.log('8081ë²ˆ í¬íŠ¸ì—ì„œ ì„œë²„ ëŒ€ê¸° ì¤‘ì…ë‹ˆë‹¤.')
    })
  ```

  - createServerë¥¼ ì›í•˜ëŠ” ë§Œí¼ í˜¸ì¶œí•˜ë©´ ë©ë‹ˆë‹¤.
  - ì´ë•Œ í¬íŠ¸ ë²ˆí˜¸ê°€ ë‹¬ë¼ì•¼ í•©ë‹ˆë‹¤. í¬íŠ¸ ë²ˆí˜¸ê°€ ê°™ìœ¼ë©´ EADDRINUSE ì—ëŸ¬ê°€ ë°œìƒí•©ë‹ˆë‹¤.

  ```javascript
  const http = require('http')
  const fs = require('fs')

  const PORT = 4000
  const server = http.createServer(async (req, res) => {
    try {
      const data = await fs.promises.readFile(`${__dirname}/server2.html`)
      res.writeHead(200, { 'Content-Type': 'text/html; charset=utf-8' })
      res.end(data)
    } catch (err) {
      console.error(err)
      res.writeHead(500, { 'Content-Type': 'text/plain; charset=utf-8' })
      res.end(err.message)
    }
  })

  server.listen(PORT, () => {
    console.log(`${PORT}ë²ˆ í¬íŠ¸ì—ì„œ ì„œë²„ ëŒ€ê¸° ì¤‘ì…ë‹ˆë‹¤.`)
  })
  ```

- HTTP ìƒíƒœ ì½”ë“œ
  - 2XX
    - ì„±ê³µì„ ì•Œë¦¬ëŠ” ìƒíƒœ ì½”ë“œì…ë‹ˆë‹¤. ëŒ€í‘œì ìœ¼ë¡œ 200(ì„±ê³µ), 201(ì‘ì„±ë¨)ì´ ë§ì´ ì‚¬ìš©ë©ë‹ˆë‹¤.
  - 3XX
    - ë¦¬ë‹¤ì´ë ‰ì…˜(ë‹¤ë¥¸ í˜ì´ì§€ë¡œ ì´ë™)ì„ ì•Œë¦¬ëŠ” ìƒíƒœ ì½”ë“œì…ë‹ˆë‹¤.
    - ì–´ë–¤ ì£¼ì†Œë¥¼ ì…ë ¥í–ˆëŠ”ë° ë‹¤ë¥¸ ì£¼ì†Œì˜ í˜ì´ì§€ë¡œ ë„˜ì–´ê°ˆ ë•Œ ì´ ì½”ë“œê°€ ì‚¬ìš©ë©ë‹ˆë‹¤.
    - ëŒ€í‘œì ìœ¼ë¡œ 301(ì˜êµ¬ ì´ë™), 302(ì„ì‹œ ì´ë™)ê°€ ìˆìŠµë‹ˆë‹¤. 304(ìˆ˜ì •ë˜ì§€ ì•ŠìŒ)ëŠ” ìš”ì²­ì˜ ì‘ë‹µìœ¼ë¡œ ìºì‹œë¥¼ ì‚¬ìš©í–ˆë‹¤ëŠ” ëœ»ì…ë‹ˆë‹¤.
  - 4XX
    - ìš”ì²­ ì˜¤ë¥˜ë¥¼ ë‚˜íƒ€ëƒ…ë‹ˆë‹¤. ìš”ì²­ ìì²´ì— ì˜¤ë¥˜ê°€ ìˆì„ ë•Œ í‘œì‹œë©ë‹ˆë‹¤.
    - ëŒ€í‘œì ìœ¼ë¡œ 400(ì˜ëª»ëœ ìš”ì²­), 401(ê¶Œí•œì—†ìŒ), 403(ê¸ˆì§€ë¨), 404(ì°¾ì„ ìˆ˜ ì—†ìŒ)ê°€ ìˆìŠµë‹ˆë‹¤.
  - 5XX
    - ì„œë²„ ì˜¤ë¥˜ë¥¼ ë‚˜íƒ€ëƒ…ë‹ˆë‹¤. ìš”ì²­ì€ ì œëŒ€ë¡œ ì™”ì§€ë§Œ ì„œë²„ì— ì˜¤ë¥˜ê°€ ìƒê²¼ì„ ë•Œ ë°œìƒí•©ë‹ˆë‹¤.
    - ì´ ì˜¤ë¥˜ë¥¼ res.writeHeadë¡œ í´ë¼ì´ì–¸íŠ¸ì— ì§ì ‘ ë³´ë‚´ëŠ” ê²½ìš°ëŠ” ê±°ì˜ ì—†ê³ , ì˜ˆê¸°ì¹˜ ëª»í•œ ì—ëŸ¬ ë°œìƒì‹œ ì„œë²„ê°€ ì•Œì•„ì„œ 5XXëŒ€ ì½”ë“œë¥¼ ë³´ëƒ…ë‹ˆë‹¤.
    - ëŒ€í‘œì ìœ¼ë¡œ 500(ë‚´ë¶€ ì„œë²„ ì˜¤ë¥˜), 502(ë¶ˆëŸ‰ ê²Œì´íŠ¸ì›¨ì´), 503(ì„œë¹„ìŠ¤ë¥¼ ì‚¬ìš©í•  ìˆ˜ ì—†ìŒ)ê°€ ìˆìŠµë‹ˆë‹¤.
  - ìš”ì²­ ì²˜ë¦¬ ê³¼ì • ì¤‘ì— ì—ëŸ¬ê°€ ë°œìƒí–ˆë‹¤ê³  í•´ì„œ ì‘ë‹µì„ ë³´ë‚´ì§€ ì•Šìœ¼ë©´ ì•ˆ ë©ë‹ˆë‹¤.
  - ìš”ì²­ì´ ì„±ê³µí–ˆë“  ì‹¤íŒ¨í–ˆë“  ì‘ë‹µì„ í´ë¼ì´ì–¸íŠ¸ë¡œ ë³´ë‚´ì„œ ìš”ì²­ì´ ë§ˆë¬´ë¦¬ë˜ì—ˆìŒì„ ì•Œë ¤ì•¼ í•©ë‹ˆë‹¤.
  - ì‘ë‹µì„ ë³´ë‚´ì§€ ì•ŠëŠ”ë‹¤ë©´, í´ë¼ì´ì–¸íŠ¸ëŠ” ì‘ë‹µì„ ê¸°ë‹¤ë¦¬ë‹¤ê°€ ì¼ì • ì‹œê°„ í›„ Timeout(ì‹œê°„ ì´ˆê³¼) ì²˜ë¦¬í•©ë‹ˆë‹¤.

## ğŸ“Œ 4.2 RESTì™€ ë¼ìš°íŒ… ì‚¬ìš©í•˜ê¸°

- REST(REpresentational State Transfer)

  - ì„œë²„ì˜ ìì›ì„ ì •ì˜í•˜ê³  ìì›ì— ëŒ€í•œ ì£¼ì†Œë¥¼ ì§€ì •í•˜ëŠ” ë°©ë²•ì„ ê°€ë¦¬í‚µë‹ˆë‹¤.
  - ìì›ì´ë¼ê³  í•´ì„œ ê¼­ íŒŒì¼ì¼ í•„ìš”ëŠ” ì—†ê³  ì„œë²„ê°€ í–‰í•  ìˆ˜ ìˆëŠ” ê²ƒë“¤ì„ í†µí‹€ì–´ì„œ ì˜ë¯¸í•©ë‹ˆë‹¤.

- REST API

  - ì£¼ì†ŒëŠ” ì˜ë¯¸ë¥¼ ëª…í™•íˆ ì „ë‹¬í•˜ê¸° ìœ„í•´ ëª…ì‚¬ë¡œ êµ¬ì„±ë©ë‹ˆë‹¤.

    - /user ì´ë©´ ì‚¬ìš©ì ì •ë³´ì— ê´€ë ¨ëœ ìì› ìš”ì²­ì´ê³ , /post ë¼ë©´ ê²Œì‹œê¸€ì— ê´€ë ¨ëœ ìì›ì„ ìš”ì²­í•˜ëŠ” ê²ƒì´ë¼ê³  ì¶”ì¸¡í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

  - ëª…ì‚¬ë§Œ ìˆìœ¼ë©´ ë¬´ìŠ¨ ë™ì‘ì„ í–‰í•˜ë¼ëŠ” ê²ƒì¸ì§€ ì•Œê¸° ì–´ë ¤ìš°ë¯€ë¡œ ì£¼ì†Œ ì™¸ì—ë„ HTTP ìš”ì²­ ë©”ì„œë“œë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤.

    - GET
      - ì„œë²„ ìì›ì„ ê°€ì ¸ì˜¤ê³ ì í•  ë•Œ ì‚¬ìš©í•©ë‹ˆë‹¤.
      - ìš”ì²­ì˜ ë³¸ë¬¸ì— ë°ì´í„°ë¥¼ ë„£ì§€ ì•ŠìŠµë‹ˆë‹¤.
      - ë°ì´í„°ë¥¼ ì„œë²„ë¡œ ë³´ë‚´ì•¼ í•œë‹¤ë©´ ì¿¼ë¦¬ìŠ¤íŠ¸ë§ì„ ì‚¬ìš©í•©ë‹ˆë‹¤.
    - POST
      - ì„œë²„ì— ìì›ì„ ìƒˆë¡œ ë“±ë¡í•˜ê³ ì í•  ë•Œ ì‚¬ìš©í•©ë‹ˆë‹¤.
      - ìš”ì²­ì˜ ë³¸ë¬¸ì— ìƒˆë¡œ ë“±ë¡í•  ë°ì´í„°ë¥¼ ë„£ì–´ ë³´ëƒ…ë‹ˆë‹¤.
    - PUT
      - ì„œë²„ì˜ ìì›ì„ ìš”ì²­ì— ë“¤ì–´ ìˆëŠ” ìì›ìœ¼ë¡œ ì¹˜í™˜í•˜ê³ ì í•  ë•Œ ì‚¬ìš©í•©ë‹ˆë‹¤.
      - ìš”ì²­ì˜ ë³¸ë¬¸ì— ì¹˜í™˜í•  ë°ì´í„°ë¥¼ ë„£ì–´ ë³´ëƒ…ë‹ˆë‹¤.
    - PATCH
      - ì„œë²„ ìì›ì˜ ì¼ë¶€ë§Œ ìˆ˜ì •í•˜ê³ ì í•  ë•Œ ì‚¬ìš©í•©ë‹ˆë‹¤.
      - ìš”ì²­ì˜ ë³¸ë¬¸ì— ì¼ë¶€ ìˆ˜ì •í•  ë°ì´í„°ë¥¼ ë„£ì–´ ë³´ëƒ…ë‹ˆë‹¤.
    - DELETE
      - ì„œë²„ì˜ ìì›ì„ ì‚­ì œí•˜ê³ ì í•  ë•Œ ì‚¬ìš©í•©ë‹ˆë‹¤.
      - ìš”ì²­ì˜ ë³¸ë¬¸ì— ë°ì´í„°ë¥¼ ë„£ì§€ ì•ŠìŠµë‹ˆë‹¤.
    - OPTIONS
      - ìš”ì²­ì„ í•˜ê¸° ì „ì— í†µì‹  ì˜µì…˜ì„ ì„¤ëª…í•˜ê¸° ìœ„í•´ ì‚¬ìš©í•©ë‹ˆë‹¤.

  - ì´ë ‡ê²Œ ì£¼ì†Œì™€ ë©”ì„œë“œë§Œ ë³´ê³  ìš”ì²­ì˜ ë‚´ìš©ì„ ì•Œì•„ë³¼ ìˆ˜ ìˆë‹¤ëŠ” ê²ƒì´ ì¥ì ì…ë‹ˆë‹¤.
  - GET ë©”ì„œë“œ ê°™ì€ ê²½ìš°ì—ëŠ” ë¸Œë¼ìš°ì €ì—ì„œ ìºì‹±í•  ìˆ˜ë„ ìˆìœ¼ë¯€ë¡œ ê°™ì€ ì£¼ì†Œë¡œ GET ìš”ì²­ì„ í•  ë•Œ ì„œë²„ì—ì„œ ê°€ì ¸ì˜¤ëŠ” ê²ƒì´ ì•„ë‹ˆë¼ ìºì‹œì—ì„œ ê°€ì ¸ì˜¬ ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤.

- RESTë¥¼ ë”°ë¥´ëŠ” ì„œë²„ë¥¼ 'RESTfulí•˜ë‹¤' ê³  í‘œí˜„í•©ë‹ˆë‹¤.

## ğŸ“Œ 4.3 ì¿ í‚¤ì™€ ì„¸ì…˜ ì´í•´í•˜ê¸°

- ì„œë²„ëŠ” ìš”ì²­ì— ëŒ€í•œ ì‘ë‹µì„ í•  ë•Œ ì¿ í‚¤ë¼ëŠ” ê²ƒì„ ê°™ì´ ë³´ëƒ…ë‹ˆë‹¤.?
- ì¿ í‚¤ëŠ” ìœ íš¨ ê¸°ê°„ì´ ìˆìœ¼ë©° ë‹¨ìˆœí•œ í‚¤-ê°’ í˜•íƒœì…ë‹ˆë‹¤.
- ì„œë²„ë¡œë¶€í„° ì¿ ê¸°ê°€ ì˜¤ë©´ ì›¹ ë¸Œë¼ìš°ì €ëŠ” ì¿ í‚¤ë¥¼ ì €ì¥í•´ë‘ì—ˆë‹¤ê°€ ë‹¤ìŒì— ìš”ì²­í•  ë•Œë§ˆë‹¤ ì¿ í‚¤ë¥¼ ë™ë´‰í•´ì„œ ë³´ëƒ…ë‹ˆë‹¤.?

  ```javascript
  const http = require('http')

  const PORT = 4000

  const server = http.createServer((req, res) => {
    console.log(req.url, req.headers.cookie)
    res.writeHead(200, { 'Set-Cookie': 'mycookie=test' })
    res.end('Hello Cookie')
  })

  server.listen(PORT, () => {
    console.log(`${PORT}ë²ˆ í¬íŠ¸ì—ì„œ ì„œë²„ ëŒ€ê¸° ì¤‘ì…ë‹ˆë‹¤.`)
  })

  // í˜¸ì¶œ ê²°ê³¼
  HTTP/1.1 200 OK
  Connection: keep-alive
  Date: Fri, 31 Dec 2021 11:52:10 GMT
  Keep-Alive: timeout=5
  Set-Cookie: mycookie=test
  Transfer-Encoding: chunked

  Hello Cookie
  ```

  - ì¿ í‚¤ëŠ” name=zerocho;year=1994 ì²˜ëŸ¼ ë¬¸ìì—´ í˜•ì‹ìœ¼ë¡œ ì¡´ì¬í•©ë‹ˆë‹¤. ì¿ í‚¤ ê°„ì—ëŠ” ì„¸ë¯¸ì½œë¡ ìœ¼ë¡œ êµ¬ë¶„ë©ë‹ˆë‹¤.

  ```javascript
  const http = require('http')
  const fs = require('fs')
  const url = require('url')
  const qs = require('querystring')

  const PORT = 4000

  const parseCookies = (cookie = '') =>
    cookie
      .split(';')
      .map((v) => v.split('='))
      .reduce((acc, [k, v]) => {
        acc[k.trim()] = decodeURIComponent(v)
        return acc
      }, {})

  const server = http.createServer(async (req, res) => {
    const cookies = parseCookies(req.headers.cookie)

    // ì£¼ì†Œê°€ /login ìœ¼ë¡œ ì‹œì‘í•˜ëŠ” ê²½ìš°
    if (req.url.startsWith('/login')) {
      const { query } = url.parse(req.url)
      const { name } = qs.parse(query)

      // ì¿ í‚¤ ìœ íš¨ ì‹œê°„ì„ í˜„ì¬ ì‹œê°„ + 5ë¶„ìœ¼ë¡œ ì„¤ì •
      const expires = new Date()
      expires.setMinutes(expires.getMinutes() + 5)
      res.writeHead(302, {
        Location: '/',
        'Set-Cookie': `name=${encodeURIComponent(
          name
        )}; Expires=${expires.toGMTString()}; HttpOnly; Path=/`,
      })
      res.end()
    } else if (cookies.name) {
      res.writeHead(200, { 'Content-Type': 'text/plain; charset=utf-8' })
      res.end(`${cookies.name}ë‹˜ ì•ˆë…•í•˜ì„¸ìš”.`)
    } else {
      try {
        const data = await fs.promises.readFile(`${__dirname}/cookie2.html`)
        res.writeHead(200, { 'Content-Type': 'text/html; charset=utf-8' })
        res.end(data)
      } catch (err) {
        res.writeHead(500, { 'Content-Type': 'text/plain; charset=utf-8' })
        res.end(err.message)
      }
    }
  })

  server.listen(PORT, () => {
    console.log(`${PORT}ë²ˆ í¬íŠ¸ì—ì„œ ì„œë²„ ëŒ€ê¸° ì¤‘ì…ë‹ˆë‹¤.`)
  })
  ```

  - Set-Cookie ë¡œ ì¿ í‚¤ë¥¼ ì„¤ì •í•  ë•Œ ë§Œë£Œ ì‹œê°„(Expires)ê³¼ HttpOnly, Path ê°™ì€ ì˜µì…˜ì„ ë¶€ì—¬í–ˆìŠµë‹ˆë‹¤.
  - ì¿ í‚¤ë¥¼ ì„¤ì •í•  ë•ŒëŠ” ê°ì¢… ì˜µì…˜ì„ ë„£ì„ ìˆ˜ ìˆìœ¼ë©°, ì˜µì…˜ ì‚¬ì´ì— ì„¸ë¯¸ì½œë¡ ì„ ì¨ì„œ êµ¬ë¶„í•˜ë©´ ë©ë‹ˆë‹¤.
    - ì¿ í‚¤ëª…=ì¿ í‚¤ê°’ : ê¸°ë³¸ì ì¸ ì¿ í‚¤ì˜ ê°’ì…ë‹ˆë‹¤.
    - Expires=ë‚ ì§œ : ë§Œë£Œ ê¸°í•œì…ë‹ˆë‹¤. ì´ ê¸°í•œì´ ì§€ë‚˜ë©´ ì¿ í‚¤ê°€ ì œê±°ë©ë‹ˆë‹¤. ê¸°ë³¸ê°’ì€ í´ë¼ì´ì–¸íŠ¸ê°€ ì¢…ë£Œë  ë•Œê¹Œì§€ì…ë‹ˆë‹¤.
    - Max-age=ì´ˆ : Expiresì™€ ë¹„ìŠ·í•˜ì§€ë§Œ ë‚ ì§œ ëŒ€ì‹  ì´ˆë¥¼ ì…ë ¥í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. í•´ë‹¹ ì´ˆê°€ ì§€ë‚˜ë©´ ì¿ í‚¤ê°€ ì œê±°ë©ë‹ˆë‹¤. Expiresë³´ë‹¤ ìš°ì„ í•©ë‹ˆë‹¤.
    - Domain=ë„ë©”ì¸ëª… : ì¿ í‚¤ê°€ ì „ì†¡ë  ë„ë©”ì¸ì„ íŠ¹ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ê¸°ë³¸ê°’ì€ í˜„ì¬ ë„ë©”ì¸ì…ë‹ˆë‹¤.
    - Path=URL : ì¿ í‚¤ê°€ ì „ì†¡ë  URLì„ íŠ¹ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ê¸°ë³¸ê°’ì€ '/' ì´ê³ , ì´ ê²½ìš° ëª¨ë“  URLì—ì„œ ì¿ í‚¤ë¥¼ ì „ì†¡í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
    - Secure : HTTPSì¼ ê²½ìš°ì—ë§Œ ì¿ í‚¤ê°€ ì „ì†¡ë©ë‹ˆë‹¤.
    - HttpOnly : ì„¤ì • ì‹œ ìë°”ìŠ¤í¬ë¦½íŠ¸ì—ì„œ ì¿ í‚¤ì— ì ‘ê·¼í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ì¿ í‚¤ ì¡°ì‘ì„ ë°©ì§€í•˜ê¸° ìœ„í•´ ì„¤ì •í•˜ëŠ” ê²ƒì´ ì¢‹ìŠµë‹ˆë‹¤.
  - ì¿ í‚¤ì—ëŠ” ë“¤ì–´ê°€ë©´ ì•ˆ ë˜ëŠ” ê¸€ìë“¤ì´ ìˆëŠ”ë°, ëŒ€í‘œì ìœ¼ë¡œ í•œê¸€ê³¼ ì¤„ë°”ê¿ˆì´ ìˆìŠµë‹ˆë‹¤. í•œê¸€ì€ encodeURIComponentë¡œ ê°ì‹¸ì„œ ë„£ìŠµë‹ˆë‹¤.

- ì„œë²„ê°€ ì‚¬ìš©ì ì •ë³´ë¥¼ ê´€ë¦¬í•˜ë„ë¡ ë§Œë“­ë‹ˆë‹¤.

  ```javascript
  const http = require('http')
  const fs = require('fs')
  const url = require('url')
  const qs = require('querystring')

  const parseCookies = (cookie = '') =>
    cookie
      .split(';')
      .map((v) => v.split('='))
      .reduce((acc, [k, v]) => {
        acc[k.trim()] = decodeURIComponent(v)
        return acc
      }, {})

  const PORT = 4000
  const session = {}

  const server = http.createServer(async (req, res) => {
    const cookies = parseCookies(req.headers.cookie)
    if (req.url.startsWith('/login')) {
      const { query } = url.parse(req.url)
      const { name } = qs.parse(query)
      const expires = new Date()
      expires.setMinutes(expires.getMinutes() + 5)
      const uniqueInt = Date.now()
      session[uniqueInt] = {
        name,
        expires,
      }
      res.writeHead(302, {
        Location: '/',
        'Set-Cookie': `session=${uniqueInt}; Expires=${expires.toGMTString()}; HttpOnly; Path=/`,
      })
      res.end()
    } else if (
      cookies.session &&
      session[cookies.session].expires > new Date()
    ) {
      // ì„¸ì…˜ ì¿ í‚¤ê°€ ì¡´ì¬í•˜ê³ , ë§Œë£Œ ê¸°ê°„ì´ ì§€ë‚˜ì§€ ì•Šì•˜ë‹¤ë©´
      res.writeHead(200, { 'Content-Type': 'text/plain; charset=utf-8' })
      res.end(`${session[cookies.session].name}ë‹˜ ì•ˆë…•í•˜ì„¸ìš”`)
    } else {
      try {
        const data = await fs.promises.readFile(`${__dirname}/cookie2.html`)
        res.writeHead(200, { 'Content-Type': 'text/html; charset=utf-8' })
        res.end(data)
      } catch (err) {
        res.writeHead(500, { 'Content-Type': 'text/plain; charset=utf-8' })
        res.end(err.message)
      }
    }
  })

  server.listen(PORT, () => {
    console.log(`${PORT}ë²ˆ í¬íŠ¸ì—ì„œ ì„œë²„ ëŒ€ê¸° ì¤‘ì…ë‹ˆë‹¤.`)
  })
  ```

  - ì„œë²„ì— ì‚¬ìš©ì ì •ë³´ë¥¼ ì €ì¥í•˜ê³  í´ë¼ì´ì–¸íŠ¸ì™€ëŠ” ì„¸ì…˜ ì•„ì´ë””ë¡œë§Œ ì†Œí†µí•©ë‹ˆë‹¤.
  - ì„¸ì…˜ ì•„ì´ë””ëŠ” ê¼­ ì¿ í‚¤ë¥¼ ì‚¬ìš©í•´ì„œ ì£¼ê³ ë°›ì§€ ì•Šì•„ë„ ë©ë‹ˆë‹¤. í•˜ì§€ë§Œ ë§ì€ ì›¹ ì‚¬ì´íŠ¸ê°€ ì¿ í‚¤ë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤.
  - ì„¸ì…˜ì„ ìœ„í•´ ì‚¬ìš©í•˜ëŠ” ì¿ í‚¤ë¥¼ ì„¸ì…˜ ì¿ í‚¤ë¼ê³  ë¶€ë¦…ë‹ˆë‹¤.
  - ì‹¤ì œ ë°°í¬ìš© ì„œë²„ì—ì„œëŠ” ì„¸ì…˜ì„ ìœ„ì™€ ê°™ì´ ë³€ìˆ˜ì— ì €ì¥í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤. ë³´í†µì€ ë ˆë””ìŠ¤(Redis)ë‚˜ ë©¤ìºì‹œë“œ(Memcached) ê°™ì€ ë°ì´í„°ë² ì´ìŠ¤ì— ë„£ì–´ë‘¡ë‹ˆë‹¤.

## ğŸ“Œ 4.4 httpsì™€ http2

- https ëª¨ë“ˆì€ ì›¹ ì„œë²„ì— SSL ì•”í˜¸í™”ë¥¼ ì¶”ê°€í•©ë‹ˆë‹¤.
- GET ì´ë‚˜ POST ìš”ì²­ì„ í•  ë•Œ ì˜¤ê°€ëŠ” ë°ì´í„°ë¥¼ ì•”í˜¸í™”í•´ì„œ ì¤‘ê°„ì— ë‹¤ë¥¸ ì‚¬ëŒì´ ìš”ì²­ì„ ê°€ë¡œì±„ë”ë¼ë„ ë‚´ìš©ì„ í™•ì¸í•  ìˆ˜ ì—†ê²Œ í•©ë‹ˆë‹¤.
- https ëŠ” ì•„ë¬´ë‚˜ ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” ê²ƒì´ ì•„ë‹™ë‹ˆë‹¤. ì•”í˜¸í™”ë¥¼ ì ìš©í•˜ëŠ” ë§Œí¼, ê·¸ê²ƒì„ ì¸ì¦í•´ì¤„ ìˆ˜ ìˆëŠ” ê¸°ê´€ë„ í•„ìš”í•©ë‹ˆë‹¤.
- ì¸ì¦ì„œëŠ” ì¸ì¦ ê¸°ê´€ì—ì„œ êµ¬ì…í•´ì•¼ í•˜ë©°, Let's Encrypt ê°™ì€ ê¸°ê´€ì—ì„œ ë¬´ë£Œë¡œ ë°œê¸‰í•´ì£¼ê¸°ë„ í•©ë‹ˆë‹¤.

  ```javascript
  // ì¸ì¦ì„œê°€ ìˆë‹¤ë©´...
  const https = require('https')
  const fs = require('fs')

  const server = https.createServer(
    {
      cert: fs.readFileSync('ë„ë©”ì¸ ì¸ì¦ì„œ ê²½ë¡œ'),
      key: fs.readFileSync('ë„ë©”ì¸ ë¹„ë°€í‚¤ ê²½ë¡œ'),
      ca: [
        fs.readFileSync('ìƒìœ„ ì¸ì¦ì„œ ê²½ë¡œ'),
        fs.readFileSync('ìƒìœ„ ì¸ì¦ì„œ ê²½ë¡œ'),
      ],
    },
    (req, res) => {
      res.writeHead(200, { 'Content-Type': 'text/html; charset=utf-8' })
      res.write('<h1>Hello Node!</h1>')
      res.end('<p>Hello Server!</p>')
    }
  )

  server.listen(443, () => {
    console.log('443ë²ˆ í¬íŠ¸ì—ì„œ ì„œë²„ ëŒ€ê¸° ì¤‘ì…ë‹ˆë‹¤.')
  })
  ```

- ë…¸ë“œì˜ http2 ëª¨ë“ˆì€ SSL ì•”í˜¸í™”ì™€ ë”ë¶ˆì–´ ìµœì‹  HTTP í”„ë¡œí† ì½œì¸ http/2 ë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆê²Œ í•©ë‹ˆë‹¤.
- http/2 ëŠ” ìš”ì²­ ë° ì‘ë‹µ ë°©ì‹ì´ ê¸°ì¡´ http/1.1 ë³´ë‹¤ ê°œì„ ë˜ì–´ í›¨ì”¬ íš¨ìœ¨ì ìœ¼ë¡œ ìš”ì²­ì„ ë³´ëƒ…ë‹ˆë‹¤.
- http/2 ë¥¼ ì‚¬ìš©í•˜ë©´ ì›¹ì˜ ì†ë„ë„ ë§ì´ ê°œì„ ë©ë‹ˆë‹¤.

  ```javascript
  const http2 = require('http2')
  const fs = require('fs')

  http2
    .createSecureServer(
      {
        cert: fs.readFileSync('ë„ë©”ì¸ ì¸ì¦ì„œ ê²½ë¡œ'),
        key: fs.readFileSync('ë„ë©”ì¸ ë¹„ë°€í‚¤ ê²½ë¡œ'),
        ca: [
          fs.readFileSync('ìƒìœ„ ì¸ì¦ì„œ ê²½ë¡œ'),
          fs.readFileSync('ìƒìœ„ ì¸ì¦ì„œ ê²½ë¡œ'),
        ],
      },
      (req, res) => {
        res.writeHead(200, { 'Content-Type': 'text/html; charset=utf-8' })
        res.write('<h1>Hello Node!</h1>')
        res.end('<p>Hello Server!</p>')
      }
    )
    .listen(443, () => {
      console.log('443ë²ˆ í¬íŠ¸ì—ì„œ ì„œë²„ ëŒ€ê¸° ì¤‘ì…ë‹ˆë‹¤.')
    })
  ```

## ğŸ“Œ 4.5 cluster

- cluster ëª¨ë“ˆì€ ê¸°ë³¸ì ìœ¼ë¡œ ì‹±ê¸€ í”„ë¡œì„¸ìŠ¤ë¡œ ë™ì‘í•˜ëŠ” ë…¸ë“œê°€ CPU ì½”ì–´ë¥¼ ëª¨ë‘ ì‚¬ìš©í•  ìˆ˜ ìˆê²Œ í•´ì£¼ëŠ” ëª¨ë“ˆì…ë‹ˆë‹¤.
- í¬íŠ¸ë¥¼ ê³µìœ í•˜ëŠ” ë…¸ë“œ í”„ë¡œì„¸ìŠ¤ë¥¼ ì—¬ëŸ¬ ê°œ ë‘˜ ìˆ˜ë„ ìˆìœ¼ë¯€ë¡œ, ìš”ì²­ì´ ë§ì´ ë“¤ì–´ì™”ì„ ë•Œ ë³‘ë ¬ë¡œ ì‹¤í–‰ëœ ì„œë²„ì˜ ê°œìˆ˜ë§Œí¼ ìš”ì²­ì´ ë¶„ì‚°ë˜ê²Œ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
- ì½”ì–´ë¥¼ í•˜ë‚˜ë§Œ ì‚¬ìš©í•  ë•Œì— ë¹„í•´ ì„±ëŠ¥ì´ ê°œì„ ë©ë‹ˆë‹¤. í•˜ì§€ë§Œ ì¥ì ë§Œ ìˆëŠ” ê²ƒì€ ì•„ë‹ˆë©°, ë©”ëª¨ë¦¬ë¥¼ ê³µìœ í•˜ì§€ ëª»í•˜ëŠ” ë“±ì˜ ë‹¨ì ë„ ìˆìŠµë‹ˆë‹¤.
- ì„¸ì…˜ì„ ë©”ëª¨ë¦¬ì— ì €ì¥í•˜ëŠ” ê²½ìš° ë¬¸ì œê°€ ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ëŠ” ë ˆë””ìŠ¤ ë“±ì˜ ì„œë²„ë¥¼ ë„ì…í•˜ì—¬ í•´ê²°í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

  ```javascript
  const cluster = require('cluster')
  const http = require('http')

  const numCPUs = require('os').cpus().length

  if (cluster.isMaster) {
    console.log(`ë§ˆìŠ¤í„° í”„ë¡œì„¸ìŠ¤ ì•„ì´ë””: ${process.pid}`)
    // CPU ê°œìˆ˜ë§Œí¼ ì›Œì»¤ë¥¼ ìƒì„±
    for (let i = 0; i < numCPUs; i += 1) {
      cluster.fork()
    }

    // ì›Œì»¤ê°€ ì¢…ë£Œë˜ì—ˆì„ ë•Œ
    cluster.on('exit', (worker, code, signal) => {
      console.log(`${worker.process.pid}ë²ˆ ì›Œì»¤ê°€ ì¢…ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.`)
      console.log('code', code, 'signal', signal)
    })
  } else {
    // ì›Œì»¤ë“¤ì´ í¬íŠ¸ì—ì„œ ëŒ€ê¸°
    http
      .createServer((req, res) => {
        res.writeHead(200, { 'Content-Type': 'text/html; charset=utf-8' })
        res.write('<h1>Hello Node!</h1>')
        res.end('<p>Hello Server!</p>')
      })
      .listen(4000)

    console.log(`${process.pid}ë²ˆ ì›Œì»¤ ì‹¤í–‰`)
  }
  ```

  - í´ëŸ¬ìŠ¤í„°ì—ëŠ” ë§ˆìŠ¤í„° í”„ë¡œì„¸ìŠ¤ì™€ ì›Œì»¤ í”„ë¡œì„¸ìŠ¤ê°€ ìˆìŠµë‹ˆë‹¤.
  - ë§ˆìŠ¤í„° í”„ë¡œì„¸ìŠ¤ëŠ” CPU ê°œìˆ˜ë§Œí¼ ì›Œì»¤ í”„ë¡œì„¸ìŠ¤ë¥¼ ë§Œë“¤ê³  ëŒ€ê¸°í•©ë‹ˆë‹¤.
  - ìš”ì²­ì´ ë“¤ì–´ì˜¤ë©´ ë§Œë“¤ì–´ì§„ ì›Œì»¤ í”„ë¡œì„¸ìŠ¤ì— ìš”ì²­ì„ ë¶„ë°°í•©ë‹ˆë‹¤.

- ì›Œì»¤ í”„ë¡œì„¸ìŠ¤ê°€ ì¡´ì¬í•˜ì—¬ ì˜¤ë¥˜ê°€ ë°œìƒí•´ë„ ì„œë²„ê°€ ì •ìƒ ì‘ë™í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë¬¼ë¡  ì˜¤ë¥˜ ìì²´ì˜ ì›ì¸ì„ ì°¾ì•„ í•´ê²°í•´ì•¼ í•©ë‹ˆë‹¤.
- ê·¸ë˜ë„ ì˜ˆê¸°ì¹˜ ëª»í•œ ì—ëŸ¬ë¡œ ì„œë²„ê°€ ì¢…ë£Œë˜ëŠ” í˜„ìƒì„ ë°©ì§€í•  ìˆ˜ ìˆì–´ í´ëŸ¬ìŠ¤í„°ë§ì„ ì ìš©í•´ë‘ëŠ” ê²ƒì´ ì¢‹ìŠµë‹ˆë‹¤.
- ì§ì ‘ cluster ëª¨ë“ˆë¡œ í´ëŸ¬ìŠ¤í„°ë§ì„ êµ¬í˜„í•  ìˆ˜ë„ ìˆì§€ë§Œ, ì‹¤ë¬´ì—ì„œëŠ” pm2 ë“±ì˜ ëª¨ë“ˆë¡œ cluster ê¸°ëŠ¥ì„ ì‚¬ìš©í•˜ê³¤ í•©ë‹ˆë‹¤.
